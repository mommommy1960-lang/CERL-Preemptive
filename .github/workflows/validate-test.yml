name: CERL-Preemptive Validation Workflow (Test Run)
on:
  workflow_dispatch:
  pull_request:
    branches: [cerl-preemptive-scaffold]

jobs:
  dryrun-validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Confirm .github/workflows/validate.yml exists and is readable
        run: |
          if [ ! -r ".github/workflows/validate.yml" ]; then
            echo ".github/workflows/validate.yml is missing or unreadable"
            exit 1
          fi

      - name: Enumerate directories and root markdown files
        run: |
          find . -type d \( -name "spec" -o -name "cli" -o -name "tests" \) > dirs.txt
          find . -maxdepth 1 -name "*.md" > root_md.txt
          cat dirs.txt root_md.txt > repo_enum.txt

      - name: Validate schema and markdown presence
        run: |
          if [ ! -r "spec/consent-schema.json" ]; then
            echo "spec/consent-schema.json is missing or unreadable"
            exit 1
          fi
          if [ ! -r "AI_GUIDE.md" ]; then
            echo "AI_GUIDE.md is missing or unreadable"
            exit 1
          fi
          python3 -c "import json; json.load(open('spec/consent-schema.json'))" 2>/dev/null || exit 1
          head -40 AI_GUIDE.md > /dev/null || exit 1

      - name: Generate dry-run artifact
        run: |
          echo "Dry Run: CERL-Preemptive Validation Report" > cerl-validation-report-test.txt
          echo "Repo: $GITHUB_REPOSITORY" >> cerl-validation-report-test.txt
          echo "Branch Ref: $GITHUB_REF" >> cerl-validation-report-test.txt
          echo "Workflow Permissions (simulated): ${{ toJson(github) }}" >> cerl-validation-report-test.txt
          echo "\nDirectory and markdown enumeration:" >> cerl-validation-report-test.txt
          cat repo_enum.txt >> cerl-validation-report-test.txt
          echo "\nSchema and markdown files are present and syntactically correct." >> cerl-validation-report-test.txt

      - name: Upload dry-run artifact
        uses: actions/upload-artifact@v3
        with:
          name: cerl-validation-report-test
          path: cerl-validation-report-test.txt
Add CERL-Preemptive Validation Workflow (Test Run)
